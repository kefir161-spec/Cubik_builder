<!--
  Cubik Build 1.1
  Design & Development: Andrey Bovdurets
  Contact: Kefir161@gmail.com
-->
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title data-i18n-key="app.title">3D Builder</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<!-- three.js libs -->
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/utils/BufferGeometryUtils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/exporters/GLTFExporter.js"></script>
<link href="3dbuilder/css/styles.css" rel="stylesheet"/>
</head>
<body>

<!-- Mobile Detection (must be first) -->
<script src="3dbuilder/js/mobile.js"></script>

<!-- Help (V51-style) -->
<div id="helpOverlay"></div>
<div aria-label="Help" aria-modal="true" id="helpModal" role="dialog">
<div class="help-title">
<div class="txt" data-i18n-key="help.title">Quick start
</div>
<button id="helpClose" title="Close">‚úï</button>
</div>
<div class="help-grid">
<div class="help-subtitle" data-i18n-key="help.navigation">Navigation</div>
<div class="help-row"><div class="ico"><img alt="LMB" class="icon-img" src="3dbuilder/icons/lmb-15939bec3f.png"/></div><div data-i18n-key="help.lmb.rotate">Hold LMB ‚Äî rotate</div></div>
<div class="help-row"><div class="ico"><img alt="RMB" class="icon-img" src="3dbuilder/icons/rmb-0be97d0005.png"/></div><div data-i18n-key="help.rmb.pan">Hold RMB ‚Äî pan</div></div>
<div class="help-row"><div class="ico"><img alt="MMB" class="icon-img" src="3dbuilder/icons/mmb-c1ff9fc800.png"/></div><div data-i18n-key="help.wheel.zoom">Mouse wheel ‚Äî zoom</div></div>
<div class="help-subtitle" data-i18n-key="help.controls">Controls</div>
<div class="help-row"><div class="ico"><img alt="LMB" class="icon-img" src="3dbuilder/icons/lmb-15939bec3f.png"/></div><div data-i18n-key="help.lmb.add">Add Cubik</div></div>
<div class="help-row"><div class="ico"><img alt="RMB" class="icon-img" src="3dbuilder/icons/rmb-0be97d0005.png"/></div><div data-i18n-key="help.rmb.delete">Delete Cubik</div></div>
<div class="help-row"><div class="ico"><img alt="MMB" class="icon-img" src="3dbuilder/icons/mmb-c1ff9fc800.png"/><img alt="Tab" class="icon-img" src="3dbuilder/icons/tab-c4e601dc07.png"/></div><div data-i18n-key="help.tab.replace">Replace/Repaint facets</div></div>
<div class="help-row"><div class="ico"><div class="ico two"><img alt="Undo" class="icon-img" src="3dbuilder/icons/undo-e08a1b1750.png"/><img alt="Redo" class="icon-img" src="3dbuilder/icons/redo-516ed939e4.png"/></div></div><div data-i18n-key="help.undo">Ctrl+Z / Ctrl+Y ‚Äî Undo / Redo</div></div>
<div class="help-row"><div class="ico"><span aria-label="Ctrl+C" class="kbd kbd-wide" role="img">Ctrl + C</span></div><div data-i18n-key="help.copy">Copy Cubik</div></div>
<div class="help-row"><div class="ico"><div aria-label="Q/R keys" class="kbd-row" role="img"><span class="kbd">Q</span><span class="kbd">R</span></div></div><div data-i18n-key="help.orbit">Orbit camera around pivot</div></div>
<div class="help-row"><div class="ico"><div class="ico two"><div aria-label="WASD keys" class="kbd-row" role="img"><span class="kbd">W</span><span class="kbd">A</span><span class="kbd">S</span><span class="kbd">D</span></div><div aria-label="E/F keys" class="kbd-row" role="img"><span class="kbd">E</span><span class="kbd">F</span></div></div></div><div data-i18n-key="help.move">Move up/down</div></div>
<div class="help-row"><div class="ico"><span aria-label="Esc key" class="kbd" role="img">Esc</span></div><div data-i18n-key="help.close">Close editor / overlays</div></div>
</div>
<div class="help-actions">
  <button class="primary glow" data-i18n-key="help.start" id="helpStart" title="Start">Start</button>
</div>
</div>
&gt;

<div id="statsBadge">Cubiks: <span id="statsBadgeCnt">0</span></div>
<!-- App header + HUD -->
<header id="appHeader">
<div class="brand">
<img alt="CUBIK.ONE" class="brand-logo" src="3dbuilder/icons/cubikone-57bd1f3988.png"/>
</div>
<div class="header-right">
<div class="hud-bar" id="hudBar">
<button class="hud-btn" id="hudLoadBtn" title="Load project" type="button">
<span aria-hidden="true" class="hud-icon"><img alt="" src="3dbuilder/icons/hudloadbtn-d05f32617a.svg"/></span>
<span class="hud-label" data-i18n-key="hud.load">Load</span>
</button>
<div class="hud-sep"></div>
<button class="hud-btn" id="hudSaveBtn" title="Save project" type="button">
<span aria-hidden="true" class="hud-icon"><img alt="" src="3dbuilder/icons/hudsavebtn-12efcfef0d.svg"/></span>
<span class="hud-label" data-i18n-key="hud.save">Save</span>
</button>
<div class="hud-sep"></div>
<div class="hud-pill hud-pill-count hud-pill-clickable" data-i18n-attr="title" data-i18n-key="hud.cubiksLabel" id="hudCubiksPill" title="Cubiks in scene (click to export stats)">
<span id="hudCnt">0</span>
<span class="hud-pill-caption" data-i18n-key="hud.cubiks">Cubiks</span>
</div>
<div class="hud-sep"></div>
<div class="hud-pill hud-pill-price" title="Estimated price">
<span id="hudPrice">$0</span>
</div>
</div>
<button aria-label="Open navigation" class="nav-toggle" id="navToggle" type="button">
<span></span><span></span><span></span>
</button>
</div>
</header>
<div id="navOverlay"></div>
<nav aria-label="Main navigation" id="sideNav">
<ul class="sideNav-list">
<li><a data-i18n-key="nav.home" href="https://cubik.one/" rel="noopener noreferrer" target="_blank">Home</a></li>
<li><a data-i18n-key="nav.shop" href="https://cubik.one/catalog/" rel="noopener noreferrer" target="_blank">Shop</a></li>
<li><a data-i18n-key="nav.about" href="https://cubik.one/about-us/" rel="noopener noreferrer" target="_blank">About us</a></li>
<li><a data-i18n-key="nav.faq" href="https://cubik.one/faq/" rel="noopener noreferrer" target="_blank">FAQ</a></li>
<li><a data-i18n-key="nav.gallery" href="https://cubik.one/gallery/" rel="noopener noreferrer" target="_blank">Gallery</a></li>
<li><a data-i18n-key="nav.video" href="https://cubik.one/video/" rel="noopener noreferrer" target="_blank">Video</a></li>
<li><a data-i18n-key="nav.blog" href="https://cubik.one/blog/" rel="noopener noreferrer" target="_blank">Blog</a></li>
<li><a data-i18n-key="nav.partnership" href="https://cubik.one/partnership/" rel="noopener noreferrer" target="_blank">Partnership</a></li>
<li><a data-i18n-key="nav.contacts" href="https://cubik.one/contacts/" rel="noopener noreferrer" target="_blank">Contacts</a></li>
</ul>
</nav>
<!-- OBJ loader removed; models embedded -->
<!-- Main left control panel -->
<div class="panel" id="ui">
<div class="panel-header">
<div class="panel-title" style="display:none"></div>
<div class="panel-actions">
<button class="icon-btn" id="clearBtn" title="Clear scene"><img alt="clearBtn" class="icon-img" src="3dbuilder/icons/clearbtn-6c7593bbba.png"/></button>
<button class="icon-btn" id="undoBtn" title="Undo (Ctrl+Z)"><img alt="undoBtn" class="icon-img" src="3dbuilder/icons/undo-e08a1b1750.png"/></button>
<button class="icon-btn" id="redoBtn" title="Redo (Ctrl+Y)"><img alt="redoBtn" class="icon-img" src="3dbuilder/icons/redo-516ed939e4.png"/></button>
<button class="icon-btn" id="replayBuildBtn" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Å–±–æ—Ä–∫—É">
<span class="icon-label">‚ñ∂</span>
</button>
<button class="icon-btn" id="recordTimelapseBtn" title="–ó–∞–ø–∏—Å–∞—Ç—å –≤–∏–¥–µ–æ —Å–±–æ—Ä–∫–∏">
<span class="icon-label">‚óè</span>
</button>
</div>
<!-- Original inline hint row; currently hidden by CSS -->
<div class="panel-hint" id="panelHint">
<div class="panel-chip"><span class="ico"><img alt="LMB" class="icon-img" src="3dbuilder/icons/lmb-15939bec3f.png"/></span><span>Add cubik</span></div>
<div class="panel-chip"><span class="ico"><img alt="RMB" class="icon-img" src="3dbuilder/icons/rmb-0be97d0005.png"/></span><span>Delete cubik</span></div>
<div class="panel-chip"><span class="ico two"><img alt="MMB" class="icon-img" src="3dbuilder/icons/mmb-c1ff9fc800.png"/><img alt="Tab" class="icon-img" src="3dbuilder/icons/tab-c4e601dc07.png"/></span><span>Replace/repaint facets</span></div>
</div>
</div>
<div class="row row-main">
<div class="gallery" id="gallery">
<div class="card" data-kind="Void" data-label="1">
<span class="badge">1</span>
<canvas></canvas>
</div>
<div class="card" data-kind="Zen" data-label="2">
<span class="badge">2</span>
<canvas></canvas>
</div>
<div class="card" data-kind="Bion" data-label="3">
<span class="badge">3</span>
<canvas></canvas>
</div>
<div class="card" data-kind="Zen/2" data-label="4">
<span class="badge">4</span>
<canvas></canvas>
</div>
</div>
</div>
<div class="row row-palette">
<div class="palette" id="palette"></div>
</div>
<div class="row row-help">
<button class="icon-btn" id="helpBtn" title="Help / Quick start"><svg aria-label="Help" class="icon-img help-q" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<g fill="none" stroke="currentColor" stroke-width="1.7" vector-effect="non-scaling-stroke">
<circle cx="12" cy="12" opacity="0.65" r="10.2"></circle>
</g>
<g fill="currentColor">
<path d="M12 16.9a1.15 1.15 0 1 0 0 2.3 1.15 1.15 0 0 0 0-2.3z"></path>
<path d="M12 4.9c-2.32 0-3.9 1.2-3.9 3.03 0 .5.38.9.88.9.46 0 .77-.22.92-.64.27-.78.88-1.3 2.1-1.3 1.24 0 2.05.7 2.05 1.7 0 .7-.36 1.2-1.2 1.8-.98.7-1.5 1.44-1.5 2.56v.24c0 .53.36.9.92.9.55 0 .9-.37.9-.9v-.17c0-.72.32-1.18 1.15-1.77 1.12-.8 1.84-1.66 1.84-2.96C15.26 6.1 13.9 4.9 12 4.9z"></path>
</g>
</svg><span class="help-label" data-i18n-key="help.btn">Help</span></button>
</div>
<!-- fallback selects (hidden in normal UI) -->
<select class="hidden-legacy" id="typeSelect">
<option selected>Bion</option>
<option>Void</option>
<option>Zen</option>
<option>Zen/2</option>
</select>
<select class="hidden-legacy" id="ralSelect">
<option value="#7D7F7D">RAL 7037</option>
<option value="#E1B589">Bion beige</option>
<option value="#0A6F3C" selected>Bion green</option>
<option value="#F4F4F4">RAL 9003</option>
<option value="#0A0A0A">RAL 9005</option>
</select>
<div class="hint" data-i18n-key="status.ready" id="status">Ready.</div>
</div>
<!-- Editor side panel -->
<div id="editor">
<div class="panel-header" style="margin-bottom:10px; display:flex; flex-direction:column; align-items:flex-start; gap:6px;">
<h3 data-i18n-key="editor.title" style="margin:0;font-size:16px;color:#fff;font-weight:600;">Block Editor</h3>
<div class="hint" data-i18n-key="editor.hint" style="width:100%;color:var(--muted);font-size:12px;line-height:1.4;">Select the facets you want to replace, pick a color in the palette, choose replacement type ‚Äî then apply.</div>
</div>
<div class="group">
<div class="group-title" data-i18n-key="editor.preview">Edited cubik preview</div>
<div id="previewWrap">
<div data-i18n-key="editor.noSelection" id="previewHint">No cubik selected</div>
</div>
</div>
<div class="group">
<div class="face-type-gallery" id="faceTypeGallery"></div>
<div style="margin-top:8px;display:flex;flex-direction:column;gap:8px">
<button class="primary" data-i18n-key="editor.replace" id="replaceBtn">Replace facets</button>
</div>
</div>
<div class="group">
<div class="palette" id="paletteFace"></div>
<select class="hidden-legacy" id="faceColor">
<option value="#7D7F7D">RAL 7037</option>
<option value="#E1B589">Bion beige</option>
<option value="#0A6F3C" selected>Bion green</option>
<option value="#F4F4F4">RAL 9003</option>
<option value="#0A0A0A">RAL 9005</option>
</select>
</div>
</div>
<div id="edOverlay" title="close"></div>
<!-- Block counter -->
<div id="stats" style="display:none">
  Blocks: <b id="cnt">0</b>
</div>
<!-- Export button -->
<button data-i18n-key="export.scene" id="exportBtn" title="Export scene to .glb">Export scene</button>
<!-- Export stats button -->
<button data-i18n-key="export.stats" id="exportStatsBtn" title="Export statistics to .txt">Export stats</button>
<!-- Facet stats panel -->
<div id="facetStats">
<div class="title">üìä</div>
<div id="facetBody"><div class="muted">‚Äî</div></div>
<div aria-expanded="true" class="sideToggle" id="facetSideToggle" title="Collapse">‚óÄ</div>
</div>


<!-- Project save/load panel -->
<div id="projectPanel">
<select id="projectSelect"></select>
<button class="icon-btn primary project-btn" data-i18n-key="project.save" id="exportJsonBtn" title="Save project as JSON">Save project</button>
<button class="icon-btn project-btn" data-i18n-key="project.load" id="importJsonBtn" title="Load project from JSON">Load project</button>
<input accept="application/json" id="importJsonInput" style="display:none" type="file"/>
</div>
<!-- Project name modal -->
<div id="projectModal">
<div class="project-modal-backdrop"></div>
<div class="project-modal-window">
<div class="project-modal-header" data-i18n-key="project.modalTitle">Save project</div>
<div class="project-modal-body">
<input autocomplete="off" data-i18n-placeholder="project.name" id="projectNameInput" placeholder="Project name" type="text"/>
</div>
<div class="project-modal-footer">
<button class="icon-btn project-btn" data-i18n-key="project.cancel" id="projectModalCancel">Cancel</button>
<button class="icon-btn primary project-btn" data-i18n-key="project.saveBtn" id="projectModalSave">Save</button>
</div>
</div>
</div>
<!-- Header HUD & navigation behavior -->
<script>
(function(){
  var body = document.body;
  var navToggle = document.getElementById('navToggle');
  var navClose  = document.getElementById('navClose');
  var sideNav   = document.getElementById('sideNav');
  var overlay   = document.getElementById('navOverlay');

  function setNavOpen(open){
    if(!sideNav) return;
    if(open){
      body.classList.add('nav-open');
    }else{
      body.classList.remove('nav-open');
    }
  }

  if(navToggle){
    navToggle.addEventListener('click', function(){
      var isOpen = body.classList.contains('nav-open');
      setNavOpen(!isOpen);
    });
  }
  if(navClose){
    navClose.addEventListener('click', function(){ setNavOpen(false); });
  }
  if(overlay){
    overlay.addEventListener('click', function(){ setNavOpen(false); });
  }

  // Proxy Load / Save
  var hudLoad = document.getElementById('hudLoadBtn');
  var hudSave = document.getElementById('hudSaveBtn');
  if(hudLoad){
    hudLoad.addEventListener('click', function(){
      var btn = document.getElementById('importJsonBtn');
      if(btn && btn.click) btn.click();
    });
  }
  if(hudSave){
    hudSave.addEventListener('click', function(){
      var btn = document.getElementById('exportJsonBtn');
      if(btn && btn.click) btn.click();
    });
  }

  // Language switcher
  var langSwitcher = document.getElementById('langSwitcher');
  if(langSwitcher){
    langSwitcher.addEventListener('click', function(e){
      var btn = e.target.closest('.lang-btn');
      if(btn && btn.dataset.lang && window.CubikI18N){
        window.CubikI18N.setLang(btn.dataset.lang);
      }
    });
  }
})();
</script>
<script>
(function(){
  var sideNav = document.getElementById('sideNav');
  var hudBar = document.getElementById('hudBar');
  if(sideNav && hudBar){
    function updateWidth(){
      var hudW = hudBar.offsetWidth + 70;
      var maxW = window.innerWidth;
      var w = Math.min(hudW, maxW);
      sideNav.style.width = w + 'px';
    }
    var observer = new MutationObserver(updateWidth);
    observer.observe(hudBar, {childList: true, subtree: true, characterData: true});
    setTimeout(updateWidth, 100);
    window.addEventListener('resize', updateWidth);
  }
})();
</script>

<!-- ============================================
     Modular JS Architecture v1.1
     All files in same directory
     ============================================ -->

<!-- Core Modules (load order matters) -->
<script src="3dbuilder/js/i18n.js"></script>
<script src="3dbuilder/js/utils.js"></script>
<script src="3dbuilder/js/renderer.js"></script>
<script src="3dbuilder/js/loader.js"></script>
<script src="3dbuilder/js/ui.js"></script>
<script src="3dbuilder/js/history.js"></script>
<script src="3dbuilder/js/autosave.js"></script>
<script src="3dbuilder/js/io.js"></script>

<script>
  // DEMO initial project JSON embedded in HTML (later can be injected from your LK/database)
  // Supported formats:
  // 1) { name, snapshot: [...], customKinds?: {...} }
  // 2) snapshot array: [...]
  window.__INITIAL_PROJECT__ = {
    "name": "Demo from HTML",
    "snapshot": [
      {
        "type": "solid",
        "kind": "Bion",
        "colorHex": "#0A6F3C",
        "position": [0, 0.5, 0],
        "rotation": [0, 0, 0],
        "scale": [1, 1, 1]
      }
    ]
  };
</script>

<!-- Main Application -->
<script src="3dbuilder/js/app.js"></script>

</body>
</html>
